--¬Â—ÙNPC
--—‡«‡
--∆’Õ®

--Ω≈±æ∫≈
x892001_g_ScriptId = 892001

--À˘”µ”–µƒ ¬º˛ID¡–±Ì
x892001_g_eventList={}


x892001_g_DarkSkillName = { [40] = {name = "NÈm ¡m khÌ", id = 274, needmoney = 20000},
                            [70] = {name = "¡m khÌ ‰ huyÆt", id = 275, needmoney = 100000},
                            [90] = {name = "¡m khÌ hµ th¨", id = 276, needmoney = 500000},
                          }                
x892001_g_DarkSkillTips = { [40] = "#{FBSJ_090106_89}",
                            [70] = "#{FBSJ_090106_90}",
                            [90] = "#{FBSJ_090106_91}",
                          }  
x892001_g_DarkBreachPointNeedMoney = 
{
	[39] = 40000,
	[49] = 50000,
	[59] = 60000,
	[69] = 70000,
	[79] = 80000,
	[89] = 90000,
	[99] = 100000,
	[109] = 110000,
	[119] = 120000,
	[129] = 130000,
}  --Õª∆∆∆øæ±–Ë“™Ω«Æ

x892001_g_strGongGaoInfo = {
  "#{_INFOUSR%s}#HTr‰i qua mµt phen cØ g°ng, rØt c¯c ho‡n th‡nh thu thßp h˛p th‡nh Vı H∞n. #YVı –∞ng #Wﬂa t£ng mµt c·i #{_INFOMSG%s} c§p 1!", 
  "#{_INFOUSR%s} #cff99ccVÏ #YVı –∞ng #cff99ccl‡m cho ´u #YLinh H∞n trang b∏ tinh hoa#cff99cc, linh h∞n trang b∏ s— gi‰ d‚ng lÍn #{_INFOMSG%s} l‡m c‰m t’!", 
  "#{_INFOUSR%s}#Hó #YVı –∞ng ti™n h‡nh #RVı H∞n #IthÂng c§p, mµt ﬂ∂ng qu· quan tr‰m tﬂæng, khÙng h± l‡ cÙng phu khÙng ph¯ lÚng ngﬂ∂i, £c t£ng c˘ng #{_INFOMSG%s}!",
  "#{_INFOUSR%s}#HKhÙng ng◊ng cØ g°ng thu thßp #RVı H∞n trang b∏ thÂng c§p #Ivßt ph¶m, ’t ﬂ˛c #W#{_INFOMSG%s}#H, thßt sÒ l‡ l‡m ngﬂ∂i ta h‚m mµ!", 
}

--**********************************
-- ¬º˛¡–±Ì
--**********************************
function x892001_UpdateEventList( sceneId, selfId,targetId )
	BeginEvent(sceneId)
		AddText(sceneId,"#{WH_NPC_17}")
		for i, eventId in x892001_g_eventList do
			CallScriptFunction( eventId, "OnEnumerate",sceneId, selfId, targetId )
		end
		
		AddNumText(sceneId,x892001_g_ScriptId,"H˛p th‡nh H∞n BÂng Ch‚u",6,7)
		AddNumText(sceneId,x892001_g_ScriptId,"C•m tinh Vı H∞n",6,8)
	EndEvent(sceneId)
	DispatchEventList(sceneId,selfId,targetId)
end

--**********************************
-- ¬º˛Ωªª•»Îø⁄
--**********************************
function x892001_OnDefaultEvent( sceneId, selfId,targetId )
	x892001_UpdateEventList( sceneId, selfId, targetId )
end

--**********************************
-- ¬º˛¡–±Ì—°÷–“ªœÓ
--**********************************
function x892001_OnEventRequest( sceneId, selfId, targetId, eventId )
	for i, findId in x892001_g_eventList do
		if eventId == findId then
			CallScriptFunction( eventId, "OnDefaultEvent",sceneId, selfId, targetId )
			return
		end
	end
	
	local NumText = GetNumText();
	if NumText == 6 then  --»°œ˚¡À
		BeginUICommand(sceneId)
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 1000)
	elseif NumText == 7 then  --Ã·…˝Œ‰ªÍµ»º∂
		BeginEvent(sceneId)
			AddText(sceneId,"C— 5 H∞n BÂng Ch‚u c˘ng ∆ng c§p cÛ th¨ h˛p th‡nh mµt c·i H∞n BÂng Ch‚u c§p cao hΩn.#r H∞n BÂng Ch‚u cÛ th¨ tÏm sﬂ phÛ TiÍu Dao Tÿ cho ngﬂΩi ti™n h‡nh thÂng c§p Vı H∞n c•m tinh.")

			AddNumText(sceneId,x892001_g_ScriptId,"H˛p th‡nh H∞n BÂng Ch‚u c§p 2",6,12)
			AddNumText(sceneId,x892001_g_ScriptId,"H˛p th‡nh H∞n BÂng Ch‚u c§p 3",6,13)
			AddNumText(sceneId,x892001_g_ScriptId,"H˛p th‡nh H∞n BÂng Ch‚u c§p 4",6,14)
			AddNumText(sceneId,x892001_g_ScriptId,"H˛p th‡nh H∞n BÂng Ch‚u c§p 5",6,15)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_081209_12}",8,130)
	
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		
	elseif NumText == 8 then  --¡ÏŒÚººƒ‹
		BeginEvent(sceneId)
			AddText(sceneId,"Sÿ d¯ng #GVı H∞n D∏ch TﬂΩng –an #WcÛ th¨ c•m tinh Vı H∞n. C•m tinh vı h∞n cÛ ﬂ˛c kh‰ nÂng m∑ rµng thuµc tÌnh, cÛ th¨ h˜c tßp k€ nÂng vı h∞n, cÛ th¨ tÂng lÍn vı h∞n c§p bßc. C¯ th¨ giæi thiÆu ngﬂΩi cÛ th¨ tÏm sﬂ ph¯ TiÍu Dao Tÿ.#r #GVı h∞n c•m tinh xong khÙng th¨ ±i ±i c•m tinh.#r#c00ffff(Thao t·c n‡y c•n th·o gﬁ b‰o th’ch ra, n™u khÙng b‰o th’ch s® bi™n m§t)")
			AddNumText(sceneId,x892001_g_ScriptId,"C•m tinh hÆ #GBÂng",6,16)
			AddNumText(sceneId,x892001_g_ScriptId,"C•m tinh hÆ #cFF0000Hˆa",6,17)
			AddNumText(sceneId,x892001_g_ScriptId,"C•m tinh hÆ #YHuy´n",6,18)
			AddNumText(sceneId,x892001_g_ScriptId,"C•m tinh hÆ #ccc33cc–µc",6,19)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_081209_12}",8,130)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)

	elseif NumText == 9 then   --Œ‰ªÍ¿©’π Ù–‘
		BeginEvent(sceneId)
			AddText(sceneId,"#{FBSJ_081209_31}")
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı H∞n (C§p 0)",6,19)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı H∞n (C§p 1)",6,20)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı H∞n (C§p 2)",6,21)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı H∞n (C§p 3)",6,22)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_081209_12}",8,130)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)

	elseif NumText == 10 then  --÷ÿœ¥∞µ∆˜ººƒ‹
		BeginUICommand(sceneId)
		UICommand_AddInt( sceneId, 6 )
		UICommand_AddInt( sceneId, targetId )
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 800034)

	elseif NumText == 11 then  --÷ÿ÷√∞µ∆˜
		BeginEvent(sceneId)
			AddText(sceneId,"#{FBSJ_081209_84}")
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_090311_03}",6,26)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_090311_04}",6,27)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_081209_12}",8,13)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)

	elseif NumText == 12 then                   --Ã·…˝ ±˘ µ»º∂
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910012)
              if c0 >=5 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,39910012,5)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 39910013, 1)--∏¯”ËŒÔ∆∑
				       local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		                     LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, h∞n bÂng ch‚u h˛p th‡nh th‡nh cÙng!"
					AddText( sceneId, strText )
				   EndEvent( sceneId )
               	          DispatchEventList( sceneId, selfId, targetId )
				x892001_ShowNotice(sceneId, selfId, targetId, strText);
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end

	elseif NumText == 13 then                   --Ã·…˝ ª µ»º∂
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910013)
              if c0 >=5 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,39910013,5)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 39910014, 1)--∏¯”ËŒÔ∆∑
				       local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		                     LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, h∞n bÂng ch‚u h˛p th‡nh th‡nh cÙng!"
					AddText( sceneId, strText )
				   EndEvent( sceneId )
               	          DispatchEventList( sceneId, selfId, targetId )
				x892001_ShowNotice(sceneId, selfId, targetId, strText);
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end
		
	elseif NumText == 130 then
		x892001_OnDefaultEvent( sceneId, selfId,targetId )
	elseif NumText == 14 then
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910014)
              if c0 >=5 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,39910014,5)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 39910015, 1)--∏¯”ËŒÔ∆∑
				       local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		                     LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, h∞n bÂng ch‚u h˛p th‡nh th‡nh cÙng!"
					AddText( sceneId, strText )
				   EndEvent( sceneId )
               	          DispatchEventList( sceneId, selfId, targetId )
				x892001_ShowNotice(sceneId, selfId, targetId, strText);
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end

	elseif NumText == 15 then
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910015)
              if c0 >=5 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,39910015,5)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 39910016, 1)--∏¯”ËŒÔ∆∑
				       local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		                     LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, h∞n bÂng ch‚u h˛p th‡nh th‡nh cÙng!"
					AddText( sceneId, strText )
				   EndEvent( sceneId )
               	          DispatchEventList( sceneId, selfId, targetId )
				x892001_ShowNotice(sceneId, selfId, targetId, strText);
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end

	elseif NumText == 16 then
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 10156101)
		c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910011)
              if c0 >=1 and c1 >=1 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,10156101,1)--…æ≥˝ŒÔ∆∑
					LuaFnDelAvailableItem(sceneId,selfId,39910011,1)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 10156102, 1)--∏¯”ËŒÔ∆∑
				    local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		            LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, vı h∞n thÂng c§p th‡nh cÙng!"
					AddText( sceneId, strText )
				EndEvent( sceneId )
               	DispatchEventList( sceneId, selfId, targetId )
				x892001_ShowNotice(sceneId, selfId, targetId, strText);
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end

	elseif NumText == 17 then
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 10156101)
		c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910011)
              if c0 >=1 and c1 >=1 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,10156101,1)--…æ≥˝ŒÔ∆∑
					LuaFnDelAvailableItem(sceneId,selfId,39910011,1)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 10156103, 1)--∏¯”ËŒÔ∆∑
				       local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		                     LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, vı h∞n thÂng c§p th‡nh cÙng!"
					AddText( sceneId, strText )
				   EndEvent( sceneId )
               	          DispatchEventList( sceneId, selfId, targetId )
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end

	elseif NumText == 18 then
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 10156101)
		c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910011)
              if c0 >=1 and c1 >=1 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,10156101,1)--…æ≥˝ŒÔ∆∑
					LuaFnDelAvailableItem(sceneId,selfId,39910011,1)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 10156104, 1)--∏¯”ËŒÔ∆∑
				       local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		                     LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, vı h∞n thÂng c§p th‡nh cÙng!"
					AddText( sceneId, strText )
				   EndEvent( sceneId )
               	          DispatchEventList( sceneId, selfId, targetId )
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end

	elseif NumText == 19 then
		c0 = LuaFnGetAvailableItemCount(sceneId, selfId, 10156101)
		c1 = LuaFnGetAvailableItemCount(sceneId, selfId, 39910011)
              if c0 >=1 and c1 >=1 then
				BeginEvent( sceneId ) 
					LuaFnDelAvailableItem(sceneId,selfId,10156101,1)--…æ≥˝ŒÔ∆∑
					LuaFnDelAvailableItem(sceneId,selfId,39910011,1)--…æ≥˝ŒÔ∆∑
					local bagpos01 = TryRecieveItem( sceneId, selfId, 10156105, 1)--∏¯”ËŒÔ∆∑
				       local szItemTransfer = GetBagItemTransfer( sceneId, selfId, bagpos01 )
					x892001_ShowRandomSystemNotice( sceneId, selfId, szItemTransfer )
		                     LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 148, 0)
					strText = "#GCh˙c m◊ng ngﬂΩi, vı h∞n thÂng c§p th‡nh cÙng!"
					AddText( sceneId, strText )
				   EndEvent( sceneId )
               	          DispatchEventList( sceneId, selfId, targetId )
             else
		     strNotice = "#GThi™u NguyÍn liÆu"
		     x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
	      end

	elseif NumText == 20 then
		BeginEvent(sceneId)

			AddText(sceneId,"M∂i lÒa ch˜n thuµc tÌnh m∑ rµng, s® Øi —ng giØng nhau Vı H∞n thuµc tÌnh!")
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 1 (BÂng c•m tinh)",6,51)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 1 (Hˆa c•m tinh)",6,52)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 1 (Huy´n c•m tinh)",6,53)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 1 (–µc c•m tinh)",6,54)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_081209_12}",8,130)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)

	elseif NumText == 21 then
		BeginEvent(sceneId)

			AddText(sceneId,"M∂i lÒa ch˜n thuµc tÌnh m∑ rµng, s® Øi —ng giØng nhau Vı H∞n thuµc tÌnh!")
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 2 (BÂng c•m tinh)",6,55)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 2 (Hˆa c•m tinh)",6,56)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 2 (Huy´n c•m tinh)",6,57)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 2 (–µc c•m tinh)",6,58)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_081209_12}",8,130)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)

	elseif NumText == 22 then
		BeginEvent(sceneId)

			AddText(sceneId,"M∂i lÒa ch˜n thuµc tÌnh m∑ rµng, s® Øi —ng giØng nhau Vı H∞n thuµc tÌnh!")
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 3 (BÂng c•m tinh)",6,59)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 3 (Hˆa c•m tinh)",6,60)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 3 (Huy´n c•m tinh)",6,61)
			AddNumText(sceneId,x892001_g_ScriptId,"M∑ rµng thuµc tÌnh Vı h∞n c§p 3 (–µc c•m tinh)",6,62)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_081209_12}",8,130)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)

	elseif NumText == 23 then
		BeginUICommand(sceneId)
		UICommand_AddInt( sceneId, 3 )
		UICommand_AddInt( sceneId, targetId )
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 800034)
	elseif NumText == 24 then
		BeginUICommand(sceneId)
		UICommand_AddInt( sceneId, 4 )
		UICommand_AddInt( sceneId, targetId )
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 800034)
	elseif NumText == 25 then
		BeginUICommand(sceneId)
		UICommand_AddInt( sceneId, 5 )
		UICommand_AddInt( sceneId, targetId )
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 800034)
	elseif NumText == 26 then
	 	BeginUICommand(sceneId)
		UICommand_AddInt( sceneId, 7 )
		UICommand_AddInt( sceneId, targetId )
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 800034)
	elseif NumText == 27 then
		BeginUICommand(sceneId)
		UICommand_AddInt( sceneId, 8 )
		UICommand_AddInt( sceneId, targetId )
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 800034)
	elseif NumText == 28 then
		BeginEvent(sceneId)
			AddText(sceneId,"#{FBSJ_081209_69}")
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_090304_02}",11,29)
			AddNumText(sceneId,x892001_g_ScriptId,"#{FBSJ_090304_01}",11,30)
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	elseif NumText == 29 then
		BeginEvent(sceneId)
			AddText(sceneId,"#{FBSJ_090304_03}")
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	elseif NumText == 30 then
		BeginEvent(sceneId)
			AddText(sceneId,"#{FBSJ_090304_04}")
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
	elseif NumText == 31 then
		BeginUICommand(sceneId)
		UICommand_AddInt( sceneId, 9 )
		UICommand_AddInt( sceneId, targetId )
		EndUICommand(sceneId)
		DispatchUICommand(sceneId,selfId, 800034)
	end
end

--**********************************
--Ω” ‹¥ÀNPCµƒ»ŒŒÒ
--**********************************
function x892001_OnMissionAccept( sceneId, selfId, targetId, missionScriptId )
	for i, findId in x892001_g_eventList do
		if missionScriptId == findId then
			ret = CallScriptFunction( missionScriptId, "CheckAccept", sceneId, selfId, targetId )
			if ret > 0 then
				CallScriptFunction( missionScriptId, "OnAccept", sceneId, selfId, targetId, missionScriptId )
			end
			return
		end
	end
end

--**********************************
--æ‹æ¯¥ÀNPCµƒ»ŒŒÒ
--**********************************
function x892001_OnMissionRefuse( sceneId, selfId, targetId, missionScriptId )
	--æ‹æ¯÷Æ∫Û£¨“™∑µªÿNPCµƒ ¬º˛¡–±Ì
	for i, findId in x892001_g_eventList do
		if missionScriptId == findId then
			x892001_UpdateEventList( sceneId, selfId, targetId )
			return
		end
	end
end

--**********************************
--ºÃ–¯£®“—æ≠Ω”¡À»ŒŒÒ£©
--**********************************
function x892001_OnMissionContinue( sceneId, selfId, targetId, missionScriptId )
	for i, findId in x892001_g_eventList do
		if missionScriptId == findId then
			CallScriptFunction( missionScriptId, "OnContinue", sceneId, selfId, targetId )
			return
		end
	end
end

--**********************************
--Ã·Ωª“—◊ˆÕÍµƒ»ŒŒÒ
--**********************************
function x892001_OnMissionSubmit( sceneId, selfId, targetId, missionScriptId, selectRadioId )
	for i, findId in x892001_g_eventList do
		if missionScriptId == findId then
			CallScriptFunction( missionScriptId, "OnSubmit", sceneId, selfId, targetId, selectRadioId )
			return
		end
	end
end

--**********************************
--À¿Õˆ ¬º˛
--**********************************
function x892001_OnDie( sceneId, selfId, killerId )
end




--**********************************
--≈–∂œ «∑Òƒ‹πª—ßœ∞
--nSkillIndex≤Œ ˝ø…ƒ‹÷µŒ™£∫40£¨70£¨90£¨∑÷±—ßœ∞∂‘”¶º∂±µƒººƒ‹
--**********************************
function x892001_CheckStudyDarkSkills( sceneId, selfId, targetId, nSkillIndex )
	
	if (nSkillIndex ~= 40 and nSkillIndex ~= 70 and nSkillIndex ~= 90) then
		return 0;
	end
	
	--≈–∂œÕÊº“µ»º∂ «∑Òπª¡À
	local strNotice = "";
	local nLevel = GetLevel(sceneId, selfId);
	if ( nLevel < nSkillIndex) then
		if (nSkillIndex == 40) then
			strNotice = "#{FBSJ_081209_24}";
		elseif (nSkillIndex == 70) then
			strNotice = "#{FBSJ_081209_27}";
		elseif (nSkillIndex == 90) then
			strNotice = "#{FBSJ_081209_29}";
		end
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	--≈–∂œ «∑Ò“—æ≠—ßª·¡À∂‘”¶ººƒ‹
	if  (HaveSkill(sceneId, selfId, x892001_g_DarkSkillName[nSkillIndex].id) > 0 ) then
		if (nSkillIndex == 40) then
			strNotice = "#{FBSJ_081209_26}";
		elseif (nSkillIndex == 70) then
			strNotice = "#{FBSJ_081209_28}";
		elseif (nSkillIndex == 90) then
			strNotice = "#{FBSJ_081209_30}";
		end
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	--≈–∂œÕÊº“…Ì…œ «∑Ò”–◊„πªµƒ«Æ
	local nHaveMoney = GetMoney(sceneId, selfId) + GetMoneyJZ(sceneId, selfId);
	if (nHaveMoney < x892001_g_DarkSkillName[nSkillIndex].needmoney) then    --10Ω
		strNotice = "#{FBSJ_081209_25}";
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	return 1;
	
end

--**********************************
--ÕÊº“’“NPC—ßœ∞∞µ∆˜ π”√ººƒ‹
--nSkillIndex≤Œ ˝ø…ƒ‹÷µŒ™£∫40£¨70£¨90£¨∑÷±—ßœ∞∂‘”¶º∂±µƒººƒ‹
--**********************************
function x892001_StudyDarkSkills( sceneId, selfId, targetId, nSkillIndex )
	
	if (nSkillIndex ~= 40 and nSkillIndex ~= 70 and nSkillIndex ~= 90) then
		return
	end
	
	--≈–∂œÕÊº“µ»º∂ «∑Òπª¡À
	local strNotice = "";
	local nLevel = GetLevel(sceneId, selfId);
	if ( nLevel < nSkillIndex) then
		if (nSkillIndex == 40) then
			strNotice = "#{FBSJ_081209_24}";
		elseif (nSkillIndex == 70) then
			strNotice = "#{FBSJ_081209_27}";
		elseif (nSkillIndex == 90) then
			strNotice = "#{FBSJ_081209_29}";
		end
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	--≈–∂œ «∑Ò“—æ≠—ßª·¡À∂‘”¶ººƒ‹
	if  (HaveSkill(sceneId, selfId, x892001_g_DarkSkillName[nSkillIndex].id) > 0 ) then
		if (nSkillIndex == 40) then
			strNotice = "#{FBSJ_081209_26}";
		elseif (nSkillIndex == 70) then
			strNotice = "#{FBSJ_081209_28}";
		elseif (nSkillIndex == 90) then
			strNotice = "#{FBSJ_081209_30}";
		end
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	--≈–∂œÕÊº“…Ì…œ «∑Ò”–◊„πªµƒ«Æ
	local nHaveMoney = GetMoney(sceneId, selfId) + GetMoneyJZ(sceneId, selfId);
	if (nHaveMoney < x892001_g_DarkSkillName[nSkillIndex].needmoney) then    --10Ω
		strNotice = "#{FBSJ_081209_25}";
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return
	end
	
	--…œ√Ê≈–∂œ∂ºÕ®π˝£¨ø…“‘ø€«Æ∏¯ººƒ‹¡À
	local nRet, nRetJB = LuaFnCostMoneyWithPriority(sceneId, selfId, x892001_g_DarkSkillName[nSkillIndex].needmoney);
	if (nRet == -1) then
		strNotice = "#{FBSJ_081209_25}";
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	AddSkill(  sceneId, selfId, x892001_g_DarkSkillName[nSkillIndex].id)
	x892001_ShowNotice(sceneId, selfId, targetId, x892001_g_DarkSkillTips[nSkillIndex]);
	x892001_NotifyTips( sceneId, selfId, x892001_g_DarkSkillTips[nSkillIndex] )
	
	x892001_StudySkillImpact(sceneId, selfId)
	DarkOperateResult(sceneId, selfId, 5, 1);    --»√ººƒ‹∞¥≈•…¡À∏
	
end


--**********************************
-- ∆¡ƒª÷–º‰–≈œ¢Ã· æ
--**********************************
function x892001_NotifyTips( sceneId, selfId, Tip )
	BeginEvent( sceneId )
		AddText( sceneId, Tip )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end


--**********************************
--ÕÊº“ «∑Ò¬˙◊„∞µ∆˜∆øæ±Ãıº˛
--∑µªÿ÷µ£∫0ªÚ’ﬂ1£¨1Œ™¬˙◊„£¨0
--**********************************
function x892001_CheckDarkReachPoint(sceneId, selfId, targetId)
		
		local strInfo = "";
		--≈–∂œÕÊº“…Ì…œ «∑Ò◊∞±∏”–∞µ∆˜
		local bHaveDarkEquip = HaveDarkEquiped(sceneId, selfId);
		if ( bHaveDarkEquip ~= 1) then
			strInfo = "#{FBSJ_081209_13}";
			x892001_ShowNotice(sceneId, selfId, targetId, strInfo);
			return 0;
		end
		
		--≈–∂œÕÊº“…Ì…œ∞µ∆˜ «∑Ò¥ÔµΩ∆øæ±
		local bNeedNPC = IsDarkNeedLevelUpByNpcNow(sceneId, selfId);
		if (bNeedNPC ~= 1) then
			strInfo = "#{FBSJ_081209_14}";
			x892001_ShowNotice(sceneId, selfId, targetId, strInfo);
			return 0;
		end
		
		--≈–∂œÕÊº“µ»º∂ «∑Ò∫Õ∞µ∆˜µ»º∂œ‡µ»ªÚ’ﬂ√ª”–∞µ∆˜µ»º∂∏ﬂ
		local nDarkLevel = GetDarkLevel(sceneId, selfId);
		local nCharLevel = GetLevel(sceneId, selfId);
		if (nDarkLevel >= nCharLevel) then
			strInfo = "#{FBSJ_081209_15}";
			x892001_ShowNotice(sceneId, selfId, targetId, strInfo);
			return 0;
		end
		
		--≈–∂œÕÊº“…Ì…œ «∑Ò”–◊„πªµƒ«Æ
		local nDarkLevel = GetDarkLevel(sceneId, selfId);
		local nNeedMoney = x892001_g_DarkBreachPointNeedMoney[nDarkLevel];
		if (nNeedMoney == nil or nNeedMoney <= 0) then
			nNeedMoney = 100000;         --“‘∑¿ÕÚ“ª£¨≤¢√ª ≤√¥”√
		end
		local nHaveMoney = GetMoney(sceneId, selfId) + GetMoneyJZ(sceneId, selfId);
		if (nHaveMoney < nNeedMoney) then    --10Ω
			strNotice = "#{FBSJ_081209_25}";
			x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
			return 0;
		end
				
		return 1;
end


function x892001_BreachDarkPoint(sceneId, selfId, targetId)

	local strInfo = "";
	--≈–∂œÕÊº“…Ì…œ «∑Ò◊∞±∏”–∞µ∆˜
	local bHaveDarkEquip = HaveDarkEquiped(sceneId, selfId);
	if ( bHaveDarkEquip ~= 1) then
		strInfo = "#{FBSJ_081209_13}";
		x892001_ShowNotice(sceneId, selfId, targetId, strInfo);
		return 0;
	end
		
	--≈–∂œÕÊº“…Ì…œ∞µ∆˜ «∑Ò¥ÔµΩ∆øæ±
	local bNeedNPC = IsDarkNeedLevelUpByNpcNow(sceneId, selfId);
	if (bNeedNPC ~= 1) then
		strInfo = "#{FBSJ_081209_14}";
		x892001_ShowNotice(sceneId, selfId, targetId, strInfo);
		return 0;
	end
		
	--≈–∂œÕÊº“µ»º∂ «∑Ò∫Õ∞µ∆˜µ»º∂œ‡µ»ªÚ’ﬂ√ª”–∞µ∆˜µ»º∂∏ﬂ
	local nDarkLevel = GetDarkLevel(sceneId, selfId);
	local nCharLevel = GetLevel(sceneId, selfId);
	if (nDarkLevel >= nCharLevel) then
		strInfo = "#{FBSJ_081209_15}";
		x892001_ShowNotice(sceneId, selfId, targetId, strInfo);
		return 0;
	end
		
			--≈–∂œÕÊº“…Ì…œ «∑Ò”–◊„πªµƒ«Æ
	local nDarkLevel = GetDarkLevel(sceneId, selfId);
	local nNeedMoney = x892001_g_DarkBreachPointNeedMoney[nDarkLevel];
	if (nNeedMoney == nil or nNeedMoney <= 0) then
		nNeedMoney = 100000;         --“‘∑¿ÕÚ“ª£¨≤¢√ª ≤√¥”√
	end
	local nHaveMoney = GetMoney(sceneId, selfId) + GetMoneyJZ(sceneId, selfId);
	if (nHaveMoney < nNeedMoney) then    --10Ω
		strNotice = "#{FBSJ_081209_25}";
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	--…œ√Ê≈–∂œ∂ºÕ®π˝£¨ø…“‘ø€«ÆÕª∆∆¡À
	local nRet, nRetJB = LuaFnCostMoneyWithPriority(sceneId, selfId, nNeedMoney);
	if (nRet == -1) then
		strNotice = "#{FBSJ_081209_25}";
		x892001_ShowNotice(sceneId, selfId, targetId, strNotice);
		return 0;
	end
	
	--Õª∆∆∆øæ±£¨»√∞µ∆˜…˝º∂
	local bDarkLevelup = DarkLevelUp(sceneId, selfId);
	if (bDarkLevelup == 1) then
		x892001_ShowNotice(sceneId, selfId, targetId, "#{FBSJ_081209_18}");
		--Õª∆∆≥…π¶£¨º«¬ºÕ≥º∆»’÷æ
			local guid = LuaFnObjId2Guid(sceneId, selfId);
			local sLog = format("dark level now: %d", nDarkLevel + 1); 
			ScriptGlobal_AuditGeneralLog(LUAAUDIT_ANQITUPO, guid, sLog);
	else
		x892001_ShowNotice(sceneId, selfId, targetId, "–µt ph· th§t b’i");
	end
	
	return
end

function x892001_ShowNotice( sceneId, selfId, targetId, strNotice)
	BeginEvent( sceneId )
		AddText( sceneId, strNotice )
	EndEvent(sceneId)
	DispatchEventList(sceneId,selfId,targetId)
end

function x892001_StudySkillImpact(sceneId, playerId)
	--œ‘ æ—ßœ∞µΩ–¬ººƒ‹µƒÃÿ–ß ƒø«∞ π”√…˝º∂Ãÿ–ß
	LuaFnSendSpecificImpactToUnit(sceneId, playerId, playerId, playerId, 32407, 0 )
end

function x892001_ShowRandomSystemNotice( sceneId, selfId, strItemInfo )
	
	local PlayerName = GetName(sceneId,selfId)
	local nMsgIndex = random( 1, 4 )
	local str
	if nMsgIndex == 1 then
		str = format( x210531_g_strGongGaoInfo[1], PlayerName, strItemInfo )
	elseif nMsgIndex == 2 then
		str = format( x210531_g_strGongGaoInfo[2], PlayerName, strItemInfo )
	elseif nMsgIndex == 3 then
		str = format( x210531_g_strGongGaoInfo[3], PlayerName, strItemInfo )
	else
		str = format( x210531_g_strGongGaoInfo[4], PlayerName, strItemInfo )
	end
	BroadMsgByChatPipe( sceneId, selfId, str, 4 )
	
end
